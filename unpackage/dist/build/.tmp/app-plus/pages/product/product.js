(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/product"],{"1a1a":function(e,t,n){"use strict";n.r(t);var o=n("9f9c"),a=n("1e4a");for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);n("aa61");var r=n("2877"),c=Object(r["a"])(a["default"],o["a"],o["b"],!1,null,null,null);t["default"]=c.exports},"1e4a":function(e,t,n){"use strict";n.r(t);var o=n("7cd0"),a=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);t["default"]=a.a},"7cd0":function(e,t,n){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=c(n("a34a")),i=n("2f62"),r=c(n("454f"));function c(e){return e&&e.__esModule?e:{default:e}}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){u(e,t,n[t])})}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,o,a,i,r){try{var c=e[i](r),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(o,a)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function r(e){d(i,o,a,r,c,"next",e)}function c(e){d(i,o,a,r,c,"throw",e)}r(void 0)})}}var l=function(){return n.e("components/auth").then(n.bind(null,"9cb0"))},p=function(){return Promise.all([n.e("common/vendor"),n.e("components/gaoyia-parse/parse")]).then(n.bind(null,"ae83"))},f=function(){return Promise.all([n.e("common/vendor"),n.e("pages/product/share")]).then(n.bind(null,"d467"))},g={components:{sharepage:f,auth:l,uParse:p},data:function(){return{hasphone:!0,specClass:"none",specSelected:[],tmpSpecText:"请选择",checkedSpecPrice:0,haslogin:!1,id:"",goods:{sortOrder:0,counterPrice:0,retailPrice:0},number:1,topicList:[],productList:[{number:0}],goodsnum:0,responsdata:{attribute:[]},brand:{},comment:{data:[]},sharedata:{},imgList:[],descontent:"",checkedGroupon_id:"",groupon:[{checked:!1}],specificationList:[],appid:"",sharepageurl:""}},onLoad:function(){var t=h(a.default.mark(function t(n){return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.id=decodeURIComponent(n.id),this.appid=decodeURIComponent(n.appid),this.sharepageurl="/pages/procuct/product?id="+this.id+"&appid="+this.appid,e.setStorageSync("sharepageurl",this.sharepageurl),this.loadData();case 5:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),onPullDownRefresh:function(){this.productdata(!0)},computed:s({},(0,i.mapState)(["hasLogin"])),methods:s({},(0,i.mapMutations)(["login"]),{onShareAppMessage:function(e){return{title:this.goods.name,path:"/pages/product/product?id="+this.id+"&appid="+this.appid}},gobrand:function(){e.navigateTo({url:"/pages/brandDetail/brandDetail?id="+this.brand.id})},loadData:function(){e.showLoading({title:"正在加载"}),""==e.getStorageSync("hasphone")&&(this.hasphone=!1),""!==e.getStorageSync("haslogin")&&(this.haslogin=!0),this.productdata()},productdata:function(t){var n=this,o="/goods/detail?id="+this.id;r.default.httpget(o).then(function(o){var a=o.data;e.hideLoading(),0==a.errno&&(n.responsdata=a.data,n.brand=n.responsdata.brand,n.goods=n.responsdata.info,n.productList=n.responsdata.productList,n.comment=n.responsdata.comment,n.specificationList=n.responsdata.specificationList,n.groupon=n.responsdata.groupon,n.descontent=n.goods.detail,n.sharedata=n.goods),t&&e.stopPullDownRefresh()}).catch(function(n){e.hideLoading(),t&&e.stopPullDownRefresh()});var a="/goods/related?id="+this.id;r.default.httpget(a).then(function(e){var t=e.data;0==t.errno&&(n.topicList=t.data.list)}).catch(function(e){});var i="/cart/goodscount";r.default.httpget(i).then(function(e){var t=e.data;0==t.errno&&(n.goodsnum=t.data)}).catch(function(e){})},clickGroupon:function(e){e.goodsName;for(var t=e.id,n=this.groupon,o=0;o<n.length;o++)n[o].id==t?n[o].checked?n[o].checked=!1:(n[o].checked=!0,this.checkedGroupon_id=n[o].id):n[o].checked=!1;this.groupon=n},toggleSpec:function(){var e=this;"show"===this.specClass?(this.specClass="hide",setTimeout(function(){e.specClass="none"},250)):"none"===this.specClass&&(this.specClass="show")},cutNumber:function(){this.number=this.number-1>1?this.number-1:1},addNumber:function(){this.number=this.number+1},addToCart:function(t){var n=this;if("hide"===this.specClass)this.specClass="show";else{if(!this.isCheckedAllSpec())return e.showToast({title:"请选择完整规格",icon:"none"}),!1;var o=this.getCheckedProductItem(this.getCheckedSpecKey());if(!o||o.length<=0)return e.showToast({title:"没有库存",icon:"none"}),!1;var a=o[0];if(a.number<=0)return e.showToast({title:"没有库存",icon:"none"}),!1;e.showLoading({title:"正在加载"});var i="/cart/add";t&&(i="/cart/fastadd"),r.default.httppost(i,{goodsId:n.goods.id,number:n.number,productId:a.id}).then(function(o){var a=o.data;0==a.errno?(e.setStorageSync("grouponRulesId",n.checkedGroupon_id),t?n.buy(a.data):e.showToast({title:"添加成功"}),n.specClass,n.goodsnum=a.data,n.toggleSpec()):501==a.errno?e.navigateTo({url:"../public/login"}):e.showToast({title:a.errmsg,icon:"none"}),e.hideLoading()})}},clickSkuValue:function(e){for(var t=e.specification,n=e.id,o=this.specificationList,a=0;a<o.length;a++)if(o[a].name===t)for(var i=0;i<o[a].valueList.length;i++)o[a].valueList[i].id==n?o[a].valueList[i].checked?o[a].valueList[i].checked=!1:o[a].valueList[i].checked=!0:o[a].valueList[i].checked=!1;this.specificationList=o,this.changeSpecInfo()},changeSpecInfo:function(){var e=this.getCheckedSpecValue(),t=e.filter(function(e){return 0!=e.valueId}).map(function(e){return e.valueText});if(t.length>0?this.tmpSpecText=t.join("　"):this.tmpSpecText="请选择规格数量",this.isCheckedAllSpec()){this.checkedSpecText=this.tmpSpecText;var n=this.getCheckedProductItem(this.getCheckedSpecKey());if(!n||n.length<=0)return this.soldout=!0,void console.error(o("规格所对应货品不存在"," at pages/product/product.vue:459"));var a=n[0];a.number>0?(this.checkedSpecPrice=a.price,this.soldout=!1):(this.checkedSpecPrice=this.goods.retailPrice,this.soldout=!0)}else this.checkedSpecText="规格数量选择",this.checkedSpecPrice=this.goods.retailPrice,this.soldout=!1},getCheckedProductItem:function(e){return this.productList.filter(function(t){return t.specifications.toString()==e.toString()})},isCheckedAllSpec:function(){return!this.getCheckedSpecValue().some(function(e){if(0==e.valueId)return!0})},getCheckedSpecKey:function(){var e=this.getCheckedSpecValue().map(function(e){return e.valueText});return e},getCheckedSpecValue:function(){for(var e=[],t=this.specificationList,n=0;n<t.length;n++){for(var o={name:t[n].name,valueId:0,valueText:""},a=0;a<t[n].valueList.length;a++)t[n].valueList[a].checked&&(o.valueId=t[n].valueList[a].id,o.valueText=t[n].valueList[a].value);e.push(o)}return e},share:function(){this.$refs.share.toggleMask()},toFavorite:function(){var t=this;e.showLoading({title:"请稍后"});var n="/collect/addordelete";r.default.httppost(n,{type:0,valueId:this.id}).then(function(n){var o=n.data;0==o.errno?(t.responsdata.userHasCollect=!t.responsdata.userHasCollect,t.responsdata.userHasCollect?e.showToast({title:"收藏成功",icon:"none"}):e.showToast({title:"取消收藏",icon:"none"})):501==o.errno&&e.navigateTo({url:"../public/login"}),e.hideLoading()}).catch(function(t){e.hideLoading()})},buy:function(t){e.setStorageSync("cartId",t),e.navigateTo({url:"/pages/order/createOrder"})},navto:function(){e.navigateTo({url:"/pages/commentlist/index?id=".concat(this.id)})},navtocart:function(){e.reLaunch({url:"/pages/cart/cart"})},navToDetailPage:function(t){var n=t.id;e.navigateTo({url:"/pages/product/product?id=".concat(n)})}})};t.default=g}).call(this,n("6e42")["default"],n("0de9")["default"])},"9f9c":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},a=[];n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a})},aa61:function(e,t,n){"use strict";var o=n("e1f5"),a=n.n(o);a.a},c7c4:function(e,t,n){"use strict";(function(e){n("d82e"),n("921b");o(n("66fd"));var t=o(n("1a1a"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},e1f5:function(e,t,n){}},[["c7c4","common/runtime","common/vendor"]]]);