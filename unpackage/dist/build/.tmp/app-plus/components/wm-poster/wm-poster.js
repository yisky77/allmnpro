(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/wm-poster/wm-poster"],{3262:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"a",function(){return r}),n.d(e,"b",function(){return i})},"38eab":function(t,e,n){},"3c72":function(t,e,n){"use strict";var r=n("38eab"),i=n.n(r);i.a},6414:function(t,e,n){"use strict";n.r(e);var r=n("3262"),i=n("c00c");for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);n("3c72");var c=n("2877"),l=Object(c["a"])(i["default"],r["a"],r["b"],!1,null,null,null);e["default"]=l.exports},b4178:function(t,e,n){"use strict";(function(t,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,a=c(n("a34a"));function c(t){return t&&t.__esModule?t:{default:t}}function l(t,e,n,r,i,a,c){try{var l=t[a](c),u=l.value}catch(o){return void n(o)}l.done?e(u):Promise.resolve(u).then(r,i)}function u(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function c(t){l(a,r,i,c,u,"next",t)}function u(t){l(a,r,i,c,u,"throw",t)}c(void 0)})}}var o={name:"wm-poster",props:{CanvasID:{Type:String,default:"PosterCanvas"},imgSrc:{Type:String,default:""},QrSrc:{Type:String,default:""},Title:{Type:String,default:""},TitleColor:{Type:String,default:"#333333"},LineType:{Type:[String,Boolean],default:!0},PriceTxt:{Type:String,default:"99.99"},PriceColor:{Type:String,default:"#e31d1a"},OriginalTxt:{Type:String,default:"199.99"},OriginalColor:{Type:String,default:"#b8b8b8"},Width:{Type:String,default:750},CanvasBg:{Type:String,default:"#ffffff"},Referrer:{Type:String,default:"quitter推荐给你"},ViewDetails:{Type:String,default:"长按或扫描识别二维码"}},data:function(){return{canvasW:0,canvasH:0,canvasImgSrc:"",ctx:null,imgSrcurl:""}},methods:{OnCanvas:function(){var e=u(a.default.mark(function e(){var n,r,c,l,u,o,s,f,x,p,d,g,T;return a.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t.showLoading({title:"正在生成海报"}),i.ctx=t.createCanvasContext(i.CanvasID,this),n=t.upx2px(i.Width),r=t.upx2px(30),c=t.upx2px(150),l=0,e.next=6,i.getImageInfo({imgSrc:i.imgSrc});case 6:return u=e.sent,e.next=9,i.getImageInfo({imgSrc:i.QrSrc});case 9:o=e.sent,s=[u.width,u.height],f=[o.width,o.height],x=n-2*r,s[0]!=x&&(s[1]=Math.floor(x/s[0]*s[1]),s[0]=x),f[0]!=c&&(f[1]=Math.floor(c/f[0]*f[1]),f[0]=c),i.canvasW=n,i.canvasH=s[1]+f[1]+128,i.ctx.setFillStyle(i.CanvasBg),i.ctx.fillRect(0,0,n,i.canvasH),i.ctx.drawImage(u.path,r,r,s[0],s[1]),i.ctx.setFontSize(t.upx2px(28)),i.ctx.setFillStyle(i.TitleColor),p=0,d=s[1]+2*r+10,g=1,T=0;case 26:if(!(T<i.Title.length)){e.next=48;break}if(l+=i.ctx.measureText(i.Title[T]).width,!(l>s[0])){e.next=44;break}if(2!=g||!i.LineType){e.next=37;break}return i.ctx.fillText(i.Title.substring(p,T-8)+"...",r,d),l=0,p=T,g++,e.abrupt("break",48);case 37:i.ctx.fillText(i.Title.substring(p,T),r,d),l=0,d+=20,p=T,g++;case 42:e.next=45;break;case 44:T==i.Title.length-1&&(i.ctx.fillText(i.Title.substring(p,T+1),r,d),l=0);case 45:T++,e.next=26;break;case 48:l=r,d+=t.upx2px(60),1==g&&(d+=20),""!=i.PriceTxt&&(i.ctx.setFillStyle(i.PriceColor),i.ctx.setFontSize(t.upx2px(38)),i.ctx.fillText(i.PriceTxt,l,d),l+=i.ctx.measureText(i.PriceTxt).width+t.upx2px(10)),""!=i.PriceTxt&&""!=i.OriginalTxt&&(i.ctx.setFillStyle(i.OriginalColor),i.ctx.setFontSize(t.upx2px(24)),i.ctx.fillText(i.OriginalTxt,l,d)),i.ctx.strokeStyle=i.OriginalColor,i.ctx.moveTo(l,d-t.upx2px(10)),i.ctx.lineTo(l+i.ctx.measureText(i.OriginalTxt).width,d-t.upx2px(10)),i.ctx.stroke(),d+=t.upx2px(20),i.ctx.drawImage(o.path,s[0]-f[0]+r,d,f[0],f[1]),i.ctx.setFillStyle(i.TitleColor),i.ctx.setFontSize(t.upx2px(30)),i.ctx.fillText(i.Referrer,r,d+f[1]/2),i.ctx.setFillStyle(i.OriginalColor),i.ctx.setFontSize(t.upx2px(24)),i.ctx.fillText(i.ViewDetails,r,d+f[1]/2+20),setTimeout(function(){i.ctx.draw(!0,function(t){i.getNewImage()}),t.hideLoading()},600);case 66:case"end":return e.stop()}},e,this)}));function n(){return e.apply(this,arguments)}return n}(),getImageInfo:function(){var e=u(a.default.mark(function e(n){var r;return a.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=n.imgSrc,e.abrupt("return",new Promise(function(e,n){t.getImageInfo({src:r,success:function(t){e(t)},fail:function(t){n(t)}})}));case 2:case"end":return e.stop()}},e,this)}));function n(t){return e.apply(this,arguments)}return n}(),getNewImage:function(){t.canvasToTempFilePath({canvasId:i.CanvasID,quality:1,complete:function(t){console.log(r(t.tempFilePath," at components/wm-poster/wm-poster.vue:205")),i.imgSrcurl=t.tempFilePath}},this)},saveImg:function(){i.$emit("save",i.imgSrcurl)}},mounted:function(){i=this,i.OnCanvas()}};e.default=o}).call(this,n("6e42")["default"],n("0de9")["default"])},c00c:function(t,e,n){"use strict";n.r(e);var r=n("b4178"),i=n.n(r);for(var a in r)"default"!==a&&function(t){n.d(e,t,function(){return r[t]})}(a);e["default"]=i.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/wm-poster/wm-poster-create-component',
    {
        'components/wm-poster/wm-poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('6e42')['createComponent'](__webpack_require__("6414"))
        })
    },
    [['components/wm-poster/wm-poster-create-component']]
]);                
